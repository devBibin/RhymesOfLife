{% load static i18n %}
<link rel="stylesheet" href="{% static 'css/new_styles.css' %}">
<link rel="stylesheet" href="{% static 'css/my_health_wellness.css' %}">

<div class="myhealth-wrap">
  <div class="myhealth-head">
    <h2 class="myhealth-title">{% trans "My Wellness Journey" %}</h2>
    
    <div class="myhealth-actions">
      <button id="btn-settings" class="btn btn-glass" type="button" aria-label="Notification settings">
        <i class="bi bi-bell me-1"></i>{% trans "Reminders" %}
      </button>
    </div>
  </div>

  <!-- New Entry Card -->
  <div class="card card-glass mb-4">
    <div class="card-header">
      <h5 class="mb-0">{% trans "Today's Check-in" %}</h5>
    </div>
    
    <div class="card-body">
      <form id="entry-form" novalidate>
        {% csrf_token %}
        
        <div class="myhealth-grid">
          <!-- Score Selection -->
          <div class="score-selector">
            <label class="form-label">
              <i class="bi bi-activity"></i> {% trans "How are you feeling?" %}
            </label>
            
            <select id="score" name="score" class="visually-hidden" aria-hidden="true">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5" selected>5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
            </select>
            
            <div class="score-visual">
              <div class="score-option" data-value="1">1</div>
              <div class="score-option" data-value="2">2</div>
              <div class="score-option" data-value="3">3</div>
              <div class="score-option" data-value="4">4</div>
              <div class="score-option" data-value="5">5</div>
              <div class="score-option" data-value="6">6</div>
              <div class="score-option" data-value="7">7</div>
              <div class="score-option" data-value="8">8</div>
              <div class="score-option" data-value="9">9</div>
              <div class="score-option" data-value="10">10</div>
            </div>
            
            <div class="score-labels">
              <span class="score-label-worst">{% trans "Tough day" %}</span>
              <span class="score-label-best">{% trans "Feeling great!" %}</span>
            </div>
            
            <div class="form-help mt-3">
              <i class="bi bi-info-circle me-1"></i>
              {% trans "Choose a number from 1 (really struggling) to 10 (feeling amazing)." %}
            </div>
          </div>
          
          <!-- Note -->
          <div>
            <label for="note" class="form-label">
              <i class="bi bi-chat-text"></i> {% trans "Add a note (optional)" %}
            </label>
            
            <textarea
              id="note"
              name="note"
              class="form-control myhealth-textarea"
              rows="4"
              placeholder="{% trans 'What made today special? What are you grateful for? Any challenges you faced?' %}"
              aria-label="Daily wellness note"
            ></textarea>
            
            <div class="form-help mt-2">
              <i class="bi bi-lightbulb me-1"></i>
              {% trans "Your notes help track patterns and celebrate progress over time." %}
            </div>
          </div>
        </div>
        
        <!-- Desktop Save Button -->
        <div class="myhealth-cta d-none d-md-flex">
          <button type="button" class="btn btn-secondary" onclick="document.getElementById('note').value = ''">
            {% trans "Clear" %}
          </button>
          <button type="button" id="btn-save" class="btn btn-primary">
            <i class="bi bi-cloud-arrow-up me-2"></i>{% trans "Save Today's Entry" %}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Mobile Save Bar -->
  <div class="myhealth-mobile-bar d-md-none">
    <button type="button" id="btn-save-mobile" class="btn btn-primary">
      <i class="bi bi-cloud-arrow-up me-2"></i>{% trans "Save Entry" %}
    </button>
  </div>

  <!-- Chart Section -->
  <div class="card card-glass mb-4">
    <div class="card-body">
      <div class="myhealth-chart-head">
        <div>
          <h5 class="mb-1">{% trans "Your Wellness Trend" %}</h5>
          <div class="myhealth-chart-sub">
            <i class="bi bi-calendar-week"></i> {% trans "Last 90 days" %}
          </div>
        </div>
        
        <div class="dropdown">
          <button class="btn btn-glass btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
            <i class="bi bi-filter me-1"></i> {% trans "Filter" %}
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#" data-days="30">{% trans "Last 30 days" %}</a></li>
            <li><a class="dropdown-item" href="#" data-days="90">{% trans "Last 90 days" %}</a></li>
            <li><a class="dropdown-item" href="#" data-days="180">{% trans "Last 6 months" %}</a></li>
          </ul>
        </div>
      </div>
      
      <div class="myhealth-chart-container">
        <canvas
          id="chart"
          class="myhealth-canvas"
          aria-label="{% trans 'Wellness trend chart showing your scores over time' %}"
          role="img"
        ></canvas>
      </div>
    </div>
  </div>

  <!-- Entries History -->
  <div class="card card-glass">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0">{% trans "Your Wellness Journal" %}</h5>
        <span class="badge bg-light text-dark">
          <span id="entries-count">0</span> {% trans "entries" %}
        </span>
      </div>
      
      <div id="entries-container">
        <ul id="entries-list" class="timeline"></ul>
        
        <!-- Empty State -->
        <div id="no-entries" class="empty-state d-none">
          <div class="empty-state-icon"><i class="bi bi-journal-text"></i></div>
          <h4 class="empty-state-title">{% trans "Your wellness journal is empty" %}</h4>
          <p class="empty-state-text">
            {% trans "Start by adding your first entry above. Track your daily wellbeing to see patterns and progress over time." %}
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Settings Modal -->
<div class="modal fade modal-glass" id="settingsModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{% trans "Reminder Settings" %}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      
      <div class="modal-body">
        <p class="text-muted mb-4">
          {% trans "Stay on track with your wellness journey. We'll gently remind you to check in when needed." %}
        </p>
        
        <div class="mb-4">
          <label class="form-label d-flex justify-content-between align-items-center">
            <span>
              <i class="bi bi-clock me-2"></i>{% trans "Reminder Frequency" %}
            </span>
            <span class="badge bg-light text-dark" id="frequency-badge">{% trans "Every 3 days" %}</span>
          </label>
          
          <select id="rem-interval" class="form-select" aria-label="Reminder frequency">
            <option value="0">{% trans "Never remind me" %}</option>
            <option value="1">{% trans "Every day" %}</option>
            <option value="3" selected>{% trans "Every 3 days" %}</option>
            <option value="7">{% trans "Every week" %}</option>
            <option value="14">{% trans "Every 2 weeks" %}</option>
          </select>
          
          <div class="form-text mt-2">
            {% trans "How often would you like to be reminded if you haven't logged an entry?" %}
          </div>
        </div>
        
        <div class="mb-4">
          <label class="form-label">
            <i class="bi bi-broadcast me-2"></i>{% trans "Notification Channels" %}
          </label>
          
          <div class="card bg-light border-0 p-3">
            <div class="form-check form-switch d-flex align-items-center justify-content-between mb-2">
              <div>
                <i class="bi bi-telegram text-primary me-2"></i>
                <label class="form-check-label" for="tg-enabled">
                  {% trans "Telegram reminders" %}
                </label>
              </div>
              <input class="form-check-input toggle-switch" type="checkbox" id="tg-enabled" role="switch">
            </div>
            
            <div class="form-check form-switch d-flex align-items-center justify-content-between">
              <div>
                <i class="bi bi-envelope text-primary me-2"></i>
                <label class="form-check-label" for="email-enabled">
                  {% trans "Email reminders" %}
                </label>
              </div>
              <input class="form-check-input toggle-switch" type="checkbox" id="email-enabled" role="switch">
            </div>
          </div>
        </div>
        
        <div class="mb-4">
          <label class="form-label">
            <i class="bi bi-alarm me-2"></i>{% trans "Preferred Time" %}
          </label>
          
          <div class="row g-3">
            <div class="col">
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-clock"></i></span>
                <input type="number" id="rem-hour" class="form-control" 
                       min="0" max="23" placeholder="20" aria-label="Hour">
                <span class="input-group-text">{% trans "hr" %}</span>
              </div>
            </div>
            <div class="col">
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-clock-history"></i></span>
                <input type="number" id="rem-min" class="form-control" 
                       min="0" max="59" placeholder="0" aria-label="Minute">
                <span class="input-group-text">{% trans "min" %}</span>
              </div>
            </div>
          </div>
          
          <div class="form-text mt-2">
            <i class="bi bi-info-circle me-1"></i>
            {% trans "Daily reminder will be sent at this time (in your local timezone)." %}
            <span id="rem-tz-label" class="ms-1 fw-medium"></span>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn btn-glass" data-bs-dismiss="modal">
          {% trans "Cancel" %}
        </button>
        <button id="btn-save-settings" class="btn btn-primary">
          <i class="bi bi-check-circle me-2"></i>{% trans "Save Preferences" %}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Success Toast -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
  <div id="success-toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header bg-success text-white">
      <i class="bi bi-check-circle me-2"></i>
      <strong class="me-auto">{% trans "Success!" %}</strong>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
    </div>
    <div class="toast-body">
      {% trans "Your wellness entry has been saved." %}
    </div>
  </div>
</div>
