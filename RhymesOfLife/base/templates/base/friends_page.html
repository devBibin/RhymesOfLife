{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-5">
  <h2 class="mb-4">üë• –ú–æ–∏ –¥—Ä—É–∑—å—è</h2>

  {% if friends %}
    <ul class="list-group mb-4">
      {% for friend in friends %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <a href="{% url 'user_profile' friend.user.username %}">
            {{ friend.user.username }} ({{ friend.first_name }} {{ friend.last_name }})
          </a>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-muted">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π</p>
  {% endif %}

  <hr class="my-5">

  <h3 class="mb-3">üîç –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>

  <form method="get" class="mb-4">
    <input type="text" name="q" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è, —Ñ–∞–º–∏–ª–∏—é –∏–ª–∏ username" value="{{ query }}">
  </form>

  {% if query %}
    <h5>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞:</h5>
    <ul class="list-group">
      {% for user in results %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <div>
            <a href="{% url 'user_profile' user.username %}">
              {{ user.username }} ({{ user.additional_info.first_name }} {{ user.additional_info.last_name }})
            </a>
          </div>
          {% if user.additional_info in request.user.additional_info.friends.all %}
            <span class="text-success">‚úÖ –£–∂–µ –≤ –¥—Ä—É–∑—å—è—Ö</span>
          {% else %}
            <form method="post" action="{% url 'send_friend_request' user.id %}" class="friend-request-form">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-outline-success">–î–æ–±–∞–≤–∏—Ç—å –≤ –¥—Ä—É–∑—å—è</button>
            </form>
          {% endif %}
        </li>
      {% empty %}
        <li class="list-group-item">–ù–∏–∫—Ç–æ –Ω–µ –Ω–∞–π–¥–µ–Ω</li>
      {% endfor %}
    </ul>
  {% endif %}
</div>
{% endblock %}
