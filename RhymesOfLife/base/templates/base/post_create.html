{% extends "base.html" %}
{% load i18n static %}
{% block title %}{% trans "New post" %} — {{ block.super }}{% endblock %}
{% block content %}
<style>
  .compose-wrap{max-width:840px;margin:0 auto}
  .card-modern{border:1px solid rgba(16,24,40,.08);border-radius:16px;box-shadow:0 6px 30px rgba(16,24,40,.06)}
  .dz-modern{border:2px dashed rgba(99,102,241,.35);border-radius:16px;padding:28px;text-align:center;background:linear-gradient(180deg,#fff,rgba(249,250,251,.6))}
  .dz-modern.drag{background:linear-gradient(180deg,#eef2ff,#fff)}
  .dz-action{display:inline-flex;align-items:center;gap:.5rem}
  .thumb{position:relative;border-radius:12px;overflow:hidden}
  .thumb img{display:block;width:100%;height:160px;object-fit:cover}
  .thumb .remove{position:absolute;top:6px;right:6px;border:none;border-radius:10px;padding:.25rem .5rem;background:rgba(0,0,0,.55);color:#fff}
  .meta-row{display:flex;justify-content:space-between;align-items:center}
  .count-chip{font-size:.875rem;padding:.25rem .55rem;border-radius:999px;background:rgba(99,102,241,.12);color:#4f46e5;font-weight:600}
  .btn-gradient{background:linear-gradient(135deg,#6366f1,#7c3aed);color:#fff;border:none}
  .btn-gradient:hover{filter:brightness(1.05);color:#fff}
</style>

<div class="container py-4 compose-wrap">

  <div class="mb-3">
    <a href="javascript:history.back()" class="btn btn-outline-secondary">
      ← {% trans "Back" %}
    </a>
  </div>

  <div id="post-create-alert" class="alert d-none" role="alert"></div>

  <form id="post-create-form" action="{% url 'post_create' %}" method="post" enctype="multipart/form-data" class="card-modern p-4">
    {% csrf_token %}

    <div class="mb-3">
      <label class="form-label fw-semibold">{% trans "Text" %}</label>
      <textarea name="text" class="form-control" rows="4" placeholder="{% trans 'Write something...' %}">{{ text|default_if_none:'' }}</textarea>
    </div>

    <div class="mb-3">
      <div class="meta-row mb-2">
        <label class="form-label fw-semibold mb-0">{% trans "Images" %}</label>
        <span class="count-chip"><span data-files-count>0</span> / <span data-files-max>10</span></span>
      </div>

      <div id="dropzone" class="dz-modern" data-max="10">
        <div class="mb-1"><i class="bi bi-cloud-upload fs-1"></i></div>
        <div class="fw-semibold">{% trans "Add photo" %}</div>
        <div class="text-muted small mb-3">{% trans "Drag & drop or click to upload" %}</div>
        <input type="file" name="images" id="file-input" accept="image/*" multiple hidden>
        <button type="button" class="btn btn-outline-primary dz-action" data-open-file>
          <i class="bi bi-images"></i> {% trans "Choose files" %}
        </button>
      </div>

      <div id="preview" class="row g-3 mt-2"></div>
    </div>

    <div class="d-flex gap-2">
      <button class="btn btn-gradient px-4">{% trans "Publish" %}</button>
      <a href="{% url 'home' %}" class="btn btn-outline-secondary">{% trans "Cancel" %}</a>
    </div>
  </form>
</div>

<script src="{% static 'js/posts.js' %}"></script>
{% endblock %}
