{% extends "base.html" %}
{% load static i18n %}

{% block title %}{% trans "New article" %} — {{ block.super }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <h1>{% trans "New article" %}</h1>

  {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
  {% endif %}

  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <div class="mb-3">
      <label class="form-label">{% trans "Title" %}</label>
      <input name="title" class="form-control" required value="{{ title }}">
    </div>

    <div class="mb-3">
      <label class="form-label">{% trans "Short description" %}</label>
      <textarea name="intro" class="form-control" required>{{ intro }}</textarea>
    </div>

    <div class="mb-3">
      <label class="form-label">{% trans "Main image" %}</label>
      <input type="file" name="main_image" class="form-control" accept="image/*">
    </div>

    <div class="mb-3">
      <label class="form-label">{% trans "Article content" %}</label>
      <textarea id="body"
                name="body"
                class="form-control js-ckeditor"
                rows="12"
                data-language="{{ LANGUAGE_CODE|slice:':2' }}"
                data-upload-url="{% url 'ck5_upload' %}"
                data-placeholder="{% trans 'Start writing…' %}">{{ body }}</textarea>
    </div>

    <div class="mb-3">
      <label class="form-label">{% trans "Tags" %}</label>
      <div class="row row-cols-2 row-cols-md-3 g-2">
        {% for tag in all_tags %}
          <div class="form-check">
            <input class="form-check-input"
                   type="checkbox"
                   name="tags"
                   id="tag-{{ forloop.counter }}"
                   value="{{ tag }}"
                   {% if tag in selected_tags %}checked{% endif %}>
            <label class="form-check-label" for="tag-{{ forloop.counter }}">
              {{ tag }}
            </label>
          </div>
        {% endfor %}
      </div>
    </div>

    <div class="d-flex gap-2">
      <button type="submit" name="action" value="draft" class="btn btn-outline-secondary">
        {% trans "Save draft" %}
      </button>
      <button type="submit" name="action" value="publish" class="btn btn-primary">
        {% trans "Publish" %}
      </button>
    </div>
  </form>
</div>
{% endblock %}

{% block extra_js %}
  <script src="https://cdn.ckeditor.com/ckeditor5/41.4.2/super-build/ckeditor.js"></script>
  {% if LANGUAGE_CODE|slice:":2" == 'ru' %}
    <script src="https://cdn.ckeditor.com/ckeditor5/41.4.2/super-build/translations/ru.js"></script>
  {% endif %}

  <script src="{% static 'js/ckeditor-init.js' %}"></script>

  <style>.ck-editor__editable_inline{min-height:360px}</style>
{% endblock %}
