{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags static i18n %}

{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="mb-0">{% trans "Articles" %}</h1>
    {% if request.user.is_staff %}
      <a href="{% url 'create_article' %}" class="btn btn-primary">✍️ {% trans "New article" %}</a>
    {% endif %}
  </div>

  <style>
    .segmented{display:inline-flex;border:1px solid var(--bs-border-color,#dee2e6);border-radius:12px;background:var(--bs-body-bg,#fff);overflow:hidden}
    .segmented__item{appearance:none;border:0;background:transparent;padding:.55rem 1rem;font-weight:500;line-height:1.2;white-space:nowrap;transition:background-color .15s,color .15s;flex:1 1 auto;box-sizing:border-box}
    .segmented__item:first-child{border-top-left-radius:12px;border-bottom-left-radius:12px}
    .segmented__item:last-child{border-top-right-radius:12px;border-bottom-right-radius:12px}
    .segmented__item:not(:last-child){position:relative}
    .segmented__item:not(:last-child)::after{content:"";position:absolute;top:22%;bottom:22%;right:0;width:1px;background:var(--bs-border-color,#dee2e6)}
    .segmented__item.is-active{background:var(--bs-dark,#212529);color:var(--bs-white,#fff)}
    .segmented__item:not(.is-active):hover{background:rgba(0,0,0,.04)}
    .segmented__item:focus-visible{outline:2px solid var(--bs-primary,#0d6efd);outline-offset:2px}
  </style>

  <form id="search-form" class="d-flex flex-wrap gap-2 align-items-center mb-4" novalidate>
    <div class="flex-grow-1">
      <div class="input-group">
        <input id="search-input" name="q" type="text" class="form-control"
               placeholder="{% trans 'Search by title, author or tags' %}" value="{{ query }}">
        <button type="submit" class="btn btn-secondary">{% trans "Search" %}</button>
      </div>
    </div>

    <input type="hidden" id="current-sort" name="sort" value="{{ sort|default:'date' }}">

    <div class="segmented" role="tablist" aria-label="{% trans 'Sort' %}">
      <button type="button" class="segmented__item {% if sort|default:'date' == 'date' %}is-active{% endif %}"
              data-sort="date"
              aria-pressed="{% if sort|default:'date' == 'date' %}true{% else %}false{% endif %}">
        {% trans "Newest" %}
      </button>
      <button type="button" class="segmented__item {% if sort == 'popular' %}is-active{% endif %}"
              data-sort="popular"
              aria-pressed="{% if sort == 'popular' %}true{% else %}false{% endif %}">
        {% trans "Most popular" %}
      </button>
    </div>
  </form>

  <div id="posts-container" data-api="{% url 'ajax_article_search' %}">
    {% include "blog/includes/article_list_fragment.html" with sort=sort query=query %}
  </div>
</div>
{% endblock content %}
